# 搜索模块使用说明

## 📦 模块概述

搜索模块已完成开发，包含前后端完整实现，支持商品关键词搜索、分页显示、搜索历史等功能。

## 🚀 快速开始

### 后端启动

1. 确保数据库已创建并初始化（参考 `docs/hwmall_db.sql`）
2. 确保商品表中有测试数据（参考 `docs/test_data.sql`）
3. 启动 Spring Boot 应用：
   ```bash
   cd service/hwMallServicedemo
   mvn spring-boot:run
   ```
4. 后端服务运行在 `http://localhost:8080`

### 前端启动

1. 安装依赖（如果还没安装）：
   ```bash
   cd web/HwMall
   npm install
   ```
2. 启动开发服务器：
   ```bash
   npm run dev
   ```
3. 前端服务运行在 `http://localhost:5173`（或 Vite 分配的端口）

## 📁 文件结构

### 后端文件

```
service/hwMallServicedemo/src/main/java/com/peng/hwmallservicedemo/
├── repository/product/
│   └── ProductRepository.java          # 已更新，添加搜索方法
├── service/search/
│   ├── SearchService.java              # 搜索服务接口
│   └── SearchServiceImpl.java          # 搜索服务实现
└── controller/search/
    └── SearchController.java           # 搜索控制器

service/hwMallServicedemo/src/main/resources/
└── mappers/
    └── productmapper.xml               # 已更新，添加搜索 SQL
```

### 前端文件

```
web/HwMall/src/
├── api/
│   └── search.js                       # 搜索 API
├── components/Search/
│   ├── SearchBox.vue                   # 搜索框组件
│   └── SearchResult.vue                # 搜索结果组件
└── views/Search/
    └── SearchView.vue                  # 搜索页面
```

## 🔌 API 接口

### 搜索商品
- **URL:** `GET /api/search`
- **请求参数:**
  - `keyword` (string, 必填): 搜索关键词
  - `page` (int, 可选): 页码，默认 1
  - `pageSize` (int, 可选): 每页数量，默认 10
- **响应:**
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "total": 25,
      "keyword": "手机",
      "list": [
        {
          "product_id": 1,
          "name": "智能手机",
          "price": 2999.00,
          "stock": 80,
          "description": "高性能处理器，大容量存储",
          "category_id": 1
        }
      ],
      "page": 1,
      "pageSize": 10
    }
  }
  ```

## 💻 前端使用

### 访问搜索页面

在浏览器中访问前端页面，点击导航栏的"搜索"链接，或直接访问搜索页面。

### 在代码中使用

```javascript
import { searchProducts } from '@/api/search.js'

// 搜索商品
const response = await searchProducts('手机', 1, 10)
if (response.code === 200) {
  const products = response.data.list
  const total = response.data.total
}
```

## ✨ 功能特性

### 1. 关键词搜索
- 支持商品名称搜索
- 支持商品描述搜索
- 使用 LIKE 模糊匹配

### 2. 搜索历史
- 自动保存搜索历史（localStorage）
- 最多保存 10 条历史记录
- 点击历史记录快速搜索
- 支持清空历史记录

### 3. 搜索结果展示
- 显示搜索结果总数
- 商品卡片展示（名称、价格、库存、描述）
- 支持分页浏览
- 无结果时友好提示

### 4. 分页功能
- 支持分页查询
- 显示当前页码和总页数
- 上一页/下一页导航

## 🧪 测试步骤

### 1. 准备测试数据

确保数据库中有商品数据，可以执行：
```sql
-- 执行测试数据脚本
source docs/test_data.sql
```

### 2. 测试搜索功能

1. 启动后端和前端服务
2. 访问前端页面，点击"搜索"
3. 在搜索框输入关键词（如"手机"、"耳机"等）
4. 点击"搜索"按钮或按回车键
5. 查看搜索结果

### 3. 测试搜索历史

1. 执行多次搜索
2. 点击搜索框，查看搜索历史
3. 点击历史记录，验证是否能快速搜索
4. 测试清空历史记录功能

### 4. 测试分页

1. 搜索一个会返回多结果的词
2. 查看分页控件
3. 点击"下一页"测试分页功能

## ⚠️ 注意事项

1. **数据库数据**：确保商品表中有测试数据，否则搜索无结果

2. **搜索性能**：
   - 当前使用 LIKE 查询，适合小数据量
   - 大数据量建议添加索引或使用全文搜索

3. **关键词验证**：
   - 后端会验证关键词不能为空
   - 关键词长度限制为 50 个字符

4. **SQL 注入防护**：
   - 使用 MyBatis 参数化查询，已防止 SQL 注入

## 🔧 接口测试

### 使用 curl 测试

```bash
# 搜索商品
curl -X GET "http://localhost:8080/api/search?keyword=手机&page=1&pageSize=10"
```

### 使用 Postman 测试

1. **Method**: `GET`
2. **URL**: `http://localhost:8080/api/search`
3. **Params**:
   - `keyword`: 手机
   - `page`: 1
   - `pageSize`: 10

## 📝 开发检查清单

- [x] 更新 ProductRepository 添加搜索方法
- [x] 创建 SearchService 接口和实现类
- [x] 创建 SearchController
- [x] 更新 productmapper.xml 添加搜索 SQL
- [x] 创建前端 search.js API 文件
- [x] 创建 SearchBox.vue 组件
- [x] 创建 SearchResult.vue 组件
- [x] 创建 SearchView.vue 页面
- [ ] 集成到主应用（App.vue）
- [ ] 配置路由（如果需要）
- [ ] 测试所有功能

## 🤝 与其他模块的集成

### 与商品模块集成

搜索结果可以跳转到商品详情页（功能待实现）：
```javascript
// 在 SearchResult.vue 中
const handleProductClick = (productId) => {
  router.push({ name: 'ProductDetail', params: { id: productId } })
}
```

### 与购物车模块集成

可以在搜索结果页面添加"加入购物车"按钮。

## 📚 相关文档

- [搜索模块开发指南](./搜索模块开发指南.md)
- [需求文档](../需求文档.md)
- [接口文档](../接口文档.md)

