# 搜索模块开发指南

## 📋 模块概述

负责商品搜索功能和搜索历史记录功能的开发。

## 👥 负责人员

1 人负责

## 🎯 开发任务

### 任务一：搜索功能开发

#### 前端开发任务

**工作目录：** `web/HwMall/src/`

1. **创建组件文件**
   - 位置：`components/Search/`
   - 需要创建的文件：
     - `SearchBox.vue` - 搜索框组件
     - `SearchResult.vue` - 搜索结果组件
     - `SearchHistory.vue` - 搜索历史组件

2. **创建页面视图**
   - 位置：`views/Search/`
   - 需要创建的文件：
     - `SearchView.vue` - 搜索结果页面

3. **创建 API 请求文件**
   - 位置：`api/`
   - 需要创建的文件：
     - `search.js` - 搜索相关的 API 请求

4. **具体实现内容**
   - 在页面顶部设计搜索框组件：
     - 输入框
     - 搜索按钮
     - 搜索建议下拉列表（可选）
   - 实现搜索功能：
     - 监听输入框回车事件
     - 监听搜索按钮点击事件
     - 输入验证（关键词不能为空）
   - 使用 Axios 向后端发送搜索请求
   - 接收后端返回的搜索结果数据
   - 在搜索结果页面展示商品信息：
     - 商品图片
     - 商品名称
     - 商品价格
     - 商品描述
   - 实现搜索结果的布局和样式
   - 支持点击商品跳转到详情页
   - 显示搜索结果数量
   - 处理无搜索结果的情况

#### 后端开发任务

**工作目录：** `service/hwMallServicedemo/src/main/java/com/peng/hwmallservicedemo/`

1. **更新数据访问层（Repository）**
   - 位置：`repository/product/ProductRepository.java`
   - 添加方法：
     - `searchByKeyword()` - 根据关键词搜索商品
     - `searchByKeywordWithPage()` - 分页搜索商品

2. **创建服务层（Service）**
   - 位置：`service/search/`
   - 需要创建的文件：
     - `SearchService.java` - 搜索服务接口
     - `SearchServiceImpl.java` - 搜索服务实现类
   - 方法：
     - `searchProducts()` - 搜索商品
     - `getSearchSuggestions()` - 获取搜索建议（可选）

3. **创建控制器（Controller）**
   - 位置：`controller/search/`
   - 需要创建的文件：
     - `SearchController.java` - 搜索控制器
   - 接口：
     - `GET /api/search` - 搜索商品

4. **具体实现内容**
   - 接收前端发送的搜索关键词
   - 验证关键词合法性（不为空、长度限制）
   - 在数据库中查询商品数据：
     - 商品名称包含关键词
     - 商品描述包含关键词
   - 使用 LIKE 查询或全文搜索
   - 返回搜索结果给前端
   - 支持分页查询
   - 按相关度排序（可选）

---

### 任务二：搜索历史记录功能（可选）

#### 前端开发任务

**工作目录：** `web/HwMall/src/`

1. **更新搜索组件**
   - 位置：`components/Search/SearchBox.vue`
   - 添加功能：
     - 在搜索框下方展示搜索历史记录
     - 从 localStorage 读取历史记录
     - 点击历史记录自动填入搜索框

2. **更新 API 请求文件**
   - 位置：`api/search.js`
   - 添加方法：
     - `saveSearchHistory()` - 保存搜索历史
     - `getSearchHistory()` - 获取搜索历史
     - `clearSearchHistory()` - 清空搜索历史

3. **具体实现内容**
   - 实现本地存储搜索历史：
     - 使用 localStorage 保存搜索关键词
     - 限制历史记录数量（如最多 10 条）
     - 去重处理
   - 展示搜索历史：
     - 在搜索框获得焦点时显示
     - 提供清空历史记录功能
   - 点击历史记录自动搜索
   - 可选：与后端同步历史记录

#### 后端开发任务（可选）

**工作目录：** `service/hwMallServicedemo/src/main/java/com/peng/hwmallservicedemo/`

1. **创建实体类（Model）**
   - 位置：`model/search/`
   - 需要创建的文件：
     - `SearchHistory.java` - 搜索历史实体类
   - 字段：history_id, user_id, keyword, search_time

2. **创建数据访问层**
   - 位置：`repository/search/`
   - 需要创建的文件：
     - `SearchHistoryRepository.java` - 搜索历史数据访问接口
   - 方法：
     - `save()` - 保存搜索历史
     - `findByUserId()` - 获取用户搜索历史
     - `deleteByUserId()` - 清空用户搜索历史

3. **更新服务层**
   - 位置：`service/search/SearchService.java`
   - 添加方法：
     - `saveSearchHistory()` - 保存搜索历史
     - `getSearchHistory()` - 获取搜索历史
     - `clearSearchHistory()` - 清空搜索历史

4. **更新控制器**
   - 位置：`controller/search/SearchController.java`
   - 添加接口：
     - `POST /api/search/history` - 保存搜索历史
     - `GET /api/search/history` - 获取搜索历史
     - `DELETE /api/search/history` - 清空搜索历史

---

## 🔗 API 接口规范

### 1. 搜索商品
- **URL:** `GET /api/search`
- **请求参数:**
  - `keyword` (string): 搜索关键词
  - `page` (int, 可选): 页码，默认 1
  - `pageSize` (int, 可选): 每页数量，默认 10
- **返回结果:**
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "total": 25,
      "keyword": "手机",
      "list": [
        {
          "productId": 1,
          "name": "iPhone 15",
          "price": 5999.00,
          "stock": 50,
          "description": "最新款iPhone手机",
          "categoryId": 1
        }
      ]
    }
  }
  ```

### 2. 保存搜索历史（可选）
- **URL:** `POST /api/search/history`
- **请求参数:**
  ```json
  {
    "userId": 1,
    "keyword": "手机"
  }
  ```
- **返回结果:**
  ```json
  {
    "code": 200,
    "message": "保存成功",
    "data": null
  }
  ```

### 3. 获取搜索历史（可选）
- **URL:** `GET /api/search/history`
- **请求参数:**
  - `userId` (int): 用户 ID
- **返回结果:**
  ```json
  {
    "code": 200,
    "message": "success",
    "data": [
      {
        "keyword": "手机",
        "searchTime": "2023-11-05 12:34:56"
      }
    ]
  }
  ```

### 4. 清空搜索历史（可选）
- **URL:** `DELETE /api/search/history`
- **请求参数:**
  - `userId` (int): 用户 ID
- **返回结果:**
  ```json
  {
    "code": 200,
    "message": "清空成功",
    "data": null
  }
  ```

---

## 📊 数据库表结构（可选）

### 搜索历史表（search_history）

| 字段名      | 数据类型    | 约束条件   | 描述                 |
| ----------- | ----------- | ---------- | -------------------- |
| history_id  | INT         | 主键、自增 | 历史记录唯一标识     |
| user_id     | INT         | 非空、外键 | 用户ID（关联用户表） |
| keyword     | VARCHAR(50) | 非空       | 搜索关键词           |
| search_time | DATETIME    | 非空       | 搜索时间             |

---

## ✅ 开发检查清单

### 前端
- [ ] 创建 SearchBox.vue 组件
- [ ] 创建 SearchResult.vue 组件
- [ ] 创建 SearchHistory.vue 组件（可选）
- [ ] 创建 SearchView.vue 页面
- [ ] 实现搜索框功能
- [ ] 实现搜索结果展示
- [ ] 实现搜索历史功能（可选）
- [ ] 配置搜索页面路由
- [ ] 创建 search.js API 文件
- [ ] 实现所有 Axios 请求
- [ ] 处理无搜索结果的情况
- [ ] 测试搜索功能

### 后端
- [ ] 更新 ProductRepository.java（添加搜索方法）
- [ ] 创建 SearchService.java 接口
- [ ] 创建 SearchServiceImpl.java 实现类
- [ ] 创建 SearchController.java
- [ ] 创建 SearchHistory.java 实体类（可选）
- [ ] 创建 SearchHistoryRepository.java（可选）
- [ ] 实现搜索商品接口
- [ ] 实现搜索历史接口（可选）
- [ ] 配置 MyBatis Mapper
- [ ] 优化搜索 SQL 查询
- [ ] 测试所有接口

---

## 📝 注意事项

1. **搜索性能**：
   - 对于大量数据，考虑使用索引优化查询性能
   - 可以考虑使用 Elasticsearch 等搜索引擎（高级功能）

2. **搜索准确性**：
   - 实现模糊搜索（LIKE '%keyword%'）
   - 考虑搜索关键词的分词处理
   - 支持多关键词搜索

3. **用户体验**：
   - 搜索框要有占位符提示
   - 支持搜索建议/自动补全（可选）
   - 搜索结果要高亮显示关键词

4. **数据验证**：
   - 搜索关键词长度限制
   - 防止 SQL 注入攻击
   - 过滤特殊字符

5. **搜索历史**：
   - 限制历史记录数量
   - 提供清空历史功能
   - 考虑用户隐私保护

6. **错误处理**：
   - 搜索无结果时的友好提示
   - 网络错误的处理
   - 搜索关键词为空的提示

---

## 💡 高级功能建议（可选）

1. **搜索建议**：
   - 根据用户输入实时显示搜索建议
   - 基于热门搜索词的推荐

2. **搜索过滤**：
   - 按价格区间过滤
   - 按商品分类过滤
   - 按销量排序

3. **搜索统计**：
   - 记录搜索热词
   - 搜索结果点击统计

4. **智能搜索**：
   - 拼写纠错
   - 同义词搜索
   - 相关商品推荐

---

## 🤝 协作说明

- 与商品模块开发人员协调商品数据的展示格式
- 搜索结果页面可以复用商品模块的商品卡片组件
- 前后端开发人员需要提前约定好 API 接口格式
- 遇到问题及时在团队群里沟通
- 代码提交前先进行本地测试
- 使用 Git 进行版本控制，提交信息要清晰明确

---

## 🔍 SQL 查询示例

### 基础搜索查询
```sql
SELECT * FROM product 
WHERE name LIKE '%关键词%' 
   OR description LIKE '%关键词%'
ORDER BY name;
```

### 分页搜索查询
```sql
SELECT * FROM product 
WHERE name LIKE '%关键词%' 
   OR description LIKE '%关键词%'
ORDER BY name
LIMIT #{offset}, #{pageSize};
```

### 搜索结果计数
```sql
SELECT COUNT(*) FROM product 
WHERE name LIKE '%关键词%' 
   OR description LIKE '%关键词%';
```
