# 购物车测试数据准备指南

## 📋 概述

在测试购物车功能之前，需要确保数据库中有以下数据：
1. **用户数据**：至少有一个用户（用于测试购物车）
2. **商品分类数据**：至少有一个商品分类
3. **商品数据**：至少有一个商品（可以添加到购物车）

## 🚀 快速开始

### 方法1：使用快速测试数据（推荐）

如果你只想快速测试，使用最小数据集：

```bash
# 1. 连接到 MySQL
mysql -u root -p

# 2. 执行快速测试数据脚本
source docs/快速测试数据.sql
```

或者直接在 MySQL 客户端中执行 `docs/快速测试数据.sql` 文件的内容。

### 方法2：使用完整测试数据

如果你想要更多测试数据：

```bash
# 在 MySQL 中执行
source docs/test_data.sql
```

## 📝 手动插入数据

如果你更喜欢手动操作，可以按以下步骤：

### 步骤1：插入商品分类

```sql
USE hwmall_db;

INSERT INTO product_category (category_id, category_name, parent_id) VALUES
(1, '数码电子', 0);
```

### 步骤2：插入用户（如果还没有）

```sql
INSERT INTO user (user_id, username, password, phone, email) VALUES
(1, 'testuser', '123456', '13800138000', 'test@example.com')
ON DUPLICATE KEY UPDATE username=VALUES(username);
```

### 步骤3：插入商品

```sql
INSERT INTO product (product_id, name, price, stock, description, category_id) VALUES
(1, '无线蓝牙耳机', 199.00, 100, '降噪设计，长续航，适合日常通勤与学习使用。', 1),
(2, '办公学习笔记本电脑', 4999.00, 50, '15.6 英寸窄边框屏幕，适合日常办公、网课与开发学习。', 1),
(3, '智能手机', 2999.00, 80, '高性能处理器，大容量存储，拍照清晰。', 1);
```

## ✅ 验证数据

执行以下 SQL 验证数据是否插入成功：

```sql
-- 查看用户
SELECT * FROM user;

-- 查看商品分类
SELECT * FROM product_category;

-- 查看商品
SELECT product_id, name, price, stock FROM product;
```

## 🎯 测试建议

### 最小测试数据集

- **用户ID**: 1
- **商品ID**: 1, 2, 3（至少3个商品用于测试）
- **商品分类ID**: 1

### 测试场景

1. **添加商品到购物车**：
   - 用户ID: 1
   - 商品ID: 1
   - 数量: 2

2. **测试库存限制**：
   - 尝试添加数量超过库存的商品（应该失败）

3. **测试重复添加**：
   - 再次添加相同的商品（应该累加数量）

## ⚠️ 注意事项

1. **外键约束**：
   - 商品表的 `category_id` 必须对应存在的分类
   - 购物车表的 `user_id` 和 `product_id` 必须对应存在的用户和商品

2. **数据完整性**：
   - 确保商品有足够的库存（stock > 0）
   - 确保价格是正数

3. **唯一约束**：
   - 用户名必须唯一
   - 购物车中同一用户的同一商品只能有一条记录（会累加数量）

## 🔧 常见问题

### 问题1：外键约束错误

**错误信息**：`Cannot add or update a child row: a foreign key constraint fails`

**解决方法**：
- 确保先插入商品分类，再插入商品
- 确保先插入用户，再插入购物车数据

### 问题2：唯一约束错误

**错误信息**：`Duplicate entry 'xxx' for key 'username'`

**解决方法**：
- 使用 `ON DUPLICATE KEY UPDATE` 语句
- 或者先删除重复数据

### 问题3：数据插入后查询不到

**解决方法**：
- 检查是否使用了正确的数据库：`USE hwmall_db;`
- 检查表名是否正确
- 检查字段名是否正确

## 📊 数据文件说明

- **`快速测试数据.sql`**：最小数据集，包含1个用户、1个分类、5个商品
- **`test_data.sql`**：完整测试数据集，包含多个用户、4个分类、20个商品

## 🎉 完成

数据准备完成后，就可以开始测试购物车功能了！

1. 启动后端服务
2. 启动前端服务
3. 在浏览器中访问前端页面
4. 尝试添加商品到购物车


