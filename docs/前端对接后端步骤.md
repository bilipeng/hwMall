# 前端对接后端 - 商品数据获取步骤

## 一、已完成的工作

### 1. ✅ 创建商品 API 文件
- 文件位置：`web/HwMall/src/api/product.js`
- 包含所有商品相关的 API 调用方法

### 2. ✅ 更新 HomeView.vue
- 导入商品 API
- 添加加载状态和错误处理
- 实现数据格式转换
- 在页面加载时自动获取数据

---

## 二、测试步骤

### 步骤1：确保后端服务运行

1. 启动 MySQL 数据库
2. 确保数据库 `hwmall_db` 中有 `product` 表和数据
3. 在 IDEA 中启动 Spring Boot 服务（运行 `HwMallServicedemoApplication.java`）
4. 确认服务运行在：`http://localhost:8080`

### 步骤2：测试后端接口

在 Postman 中测试：
```
GET http://localhost:8080/api/product/list
```

预期返回：
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "product_id": 1,
      "name": "商品名称",
      "price": 199.00,
      "stock": 100,
      "description": "商品描述",
      "category_id": 1
    }
  ]
}
```

### 步骤3：启动前端服务

1. 打开终端，进入前端目录：
   ```bash
   cd web/HwMall
   ```

2. 启动开发服务器：
   ```bash
   npm run dev
   ```

3. 浏览器访问：`http://localhost:5173`（或终端显示的地址）

### 步骤4：检查数据加载

1. 打开浏览器开发者工具（F12）
2. 切换到 `Network`（网络）标签
3. 刷新页面
4. 查看是否有请求发送到 `http://localhost:8080/api/product/list`
5. 检查响应数据是否正确

### 步骤5：查看控制台

1. 在浏览器开发者工具中切换到 `Console`（控制台）标签
2. 查看是否有错误信息
3. 如果有错误，根据错误信息进行排查

---

## 三、数据格式说明

### 后端返回格式：
```json
{
  "product_id": 1,
  "name": "商品名称",
  "price": 199.00,
  "stock": 100,
  "description": "商品描述",
  "category_id": 1
}
```

### 前端转换后格式：
```javascript
{
  id: 1,
  name: "商品名称",
  price: 199.00,
  category: "数码电子",  // 根据 category_id 转换
  description: "商品描述",
  stock: 100,
  isHot: true,  // 暂时随机生成
  isNew: false  // 暂时随机生成
}
```

---

## 四、分类ID映射

当前代码中的分类映射（需要根据你的数据库实际情况调整）：

```javascript
const categoryMap = {
  1: '数码电子',
  2: '家居生活',
  3: '服饰鞋包',
  4: '美食零食'
}
```

**如果数据库中的分类ID不同，需要修改 `HomeView.vue` 中的 `categoryMap`。**

---

## 五、常见问题排查

### 问题1：页面显示"加载中..."一直不消失

**可能原因：**
- 后端服务未启动
- 网络请求失败
- CORS 跨域问题

**解决方法：**
1. 检查后端服务是否运行
2. 查看浏览器控制台错误信息
3. 检查 `request.js` 中的 `baseURL` 是否正确

### 问题2：显示错误信息

**可能原因：**
- 后端接口返回错误
- 数据格式不匹配
- 数据库连接失败

**解决方法：**
1. 查看浏览器控制台的具体错误信息
2. 在 Postman 中测试后端接口是否正常
3. 检查数据库是否有数据

### 问题3：商品显示但分类名称不对

**解决方法：**
- 修改 `HomeView.vue` 中的 `categoryMap`，确保分类ID映射正确

### 问题4：CORS 跨域错误

**解决方法：**
在后端添加 CORS 配置（如果还没有的话）：

```java
@Configuration
public class CorsConfig {
    @Bean
    public WebMvcConfigurer corsConfigurer() {
        return new WebMvcConfigurer() {
            @Override
            public void addCorsMappings(CorsRegistry registry) {
                registry.addMapping("/api/**")
                        .allowedOrigins("http://localhost:5173", "http://localhost:3000")
                        .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
                        .allowedHeaders("*")
                        .allowCredentials(true);
            }
        };
    }
}
```

---

## 六、下一步优化建议

1. **添加热门/新品标识**：如果后端有 `is_hot` 和 `is_new` 字段，可以修改数据转换逻辑
2. **添加图片支持**：如果后端返回图片URL，可以直接使用
3. **添加分页加载**：如果商品数量很多，可以使用分页接口
4. **添加缓存**：避免重复请求相同数据
5. **优化加载体验**：添加骨架屏或加载动画

---

## 七、测试清单

- [ ] 后端服务正常启动
- [ ] Postman 测试接口返回数据
- [ ] 前端服务正常启动
- [ ] 浏览器能正常访问页面
- [ ] 网络请求成功发送
- [ ] 商品数据正常显示
- [ ] 热门推荐区域有数据
- [ ] 精选商品区域有数据
- [ ] 新品上市区域有数据
- [ ] 加载状态正常显示
- [ ] 错误处理正常工作

---

完成以上步骤后，你的首页就能从后端获取真实数据了！🎉

