# 购物车模块开发指南

## 📋 模块概述

负责购物车的添加、删除、修改、查询等功能的开发。

## 👥 负责人员

1 人负责

## 🎯 开发任务

### 任务一：购物车功能开发

#### 前端开发任务

**工作目录：** `web/HwMall/src/`

1. **创建组件文件**
   - 位置：`components/Cart/`
   - 需要创建的文件：
     - `Cart.vue` - 购物车组件
     - `CartItem.vue` - 购物车商品项组件

2. **创建页面视图**
   - 位置：`views/Cart/`
   - 需要创建的文件：
     - `CartView.vue` - 购物车页面

3. **创建 API 请求文件**
   - 位置：`api/`
   - 需要创建的文件：
     - `cart.js` - 购物车相关的 API 请求

4. **具体实现内容**
   - 开发购物车页面布局
   - 展示购物车中的商品信息：
     - 商品图片
     - 商品名称
     - 商品价格
     - 商品数量
     - 小计金额
   - 实现添加商品到购物车功能：
     - 在商品详情页点击"加入购物车"按钮
     - 发送商品 ID 和数量到后端
     - 更新购物车图标的商品数量
   - 实现购物车商品数量修改功能：
     - 数量增加/减少按钮
     - 手动输入数量
     - 实时更新小计和总计
   - 实现删除购物车商品功能
   - 实现全选/取消全选功能
   - 实现商品选中状态管理
   - 显示购物车总金额
   - 实现"去结算"按钮（跳转到订单确认页）
   - 使用 Axios 与后端交互

#### 后端开发任务

**工作目录：** `service/hwMallServicedemo/src/main/java/com/peng/hwmallservicedemo/`

1. **创建实体类（Model）**
   - 位置：`model/cart/`
   - 需要创建的文件：
     - `Cart.java` - 购物车实体类
     - `CartVO.java` - 购物车视图对象（包含商品详细信息）
   - Cart 字段：cart_id, user_id, product_id, quantity

2. **创建数据访问层（Repository）**
   - 位置：`repository/cart/`
   - 需要创建的文件：
     - `CartRepository.java` - 购物车数据访问接口
   - 方法：
     - `findByUserId()` - 根据用户 ID 查询购物车
     - `findByUserIdAndProductId()` - 查询用户购物车中的特定商品
     - `save()` - 添加商品到购物车
     - `update()` - 更新购物车商品数量
     - `delete()` - 删除购物车商品
     - `deleteByUserId()` - 清空用户购物车

3. **创建服务层（Service）**
   - 位置：`service/cart/`
   - 需要创建的文件：
     - `CartService.java` - 购物车服务接口
     - `CartServiceImpl.java` - 购物车服务实现类
   - 方法：
     - `addToCart()` - 添加商品到购物车
     - `getCartList()` - 获取购物车商品列表
     - `updateCartItemQuantity()` - 更新购物车商品数量
     - `removeCartItem()` - 删除购物车商品
     - `clearCart()` - 清空购物车
     - `getCartCount()` - 获取购物车商品总数

4. **创建控制器（Controller）**
   - 位置：`controller/cart/`
   - 需要创建的文件：
     - `CartController.java` - 购物车控制器
   - 接口：
     - `POST /api/cart/add` - 添加商品到购物车
     - `GET /api/cart/list` - 获取购物车商品列表
     - `PUT /api/cart/update` - 更新购物车商品数量
     - `DELETE /api/cart/delete/{cartId}` - 删除购物车商品
     - `DELETE /api/cart/clear` - 清空购物车
     - `GET /api/cart/count` - 获取购物车商品数量

5. **具体实现内容**
   - 接收前端发送的购物车操作请求
   - 验证用户身份（通过 Token 或 Session）
   - 检查商品是否存在
   - 检查库存是否充足
   - 操作数据库进行增删改查
   - 返回操作结果给前端
   - 返回购物车商品列表时需要关联查询商品信息

---

## 📊 数据库表结构

### 购物车表（cart）

| 字段名     | 数据类型 | 约束条件   | 描述                 |
| ---------- | -------- | ---------- | -------------------- |
| cart_id    | INT      | 主键、自增 | 购物车唯一标识       |
| user_id    | INT      | 非空、外键 | 用户ID（关联用户表） |
| product_id | INT      | 非空、外键 | 商品ID（关联商品表） |
| quantity   | INT      | 非空       | 购买数量             |

---

## 🔗 API 接口规范

### 1. 添加商品到购物车
- **URL:** `POST /api/cart/add`
- **请求参数:**
  ```json
  {
    "userId": 1,
    "productId": 1,
    "quantity": 1
  }
  ```
- **返回结果:**
  ```json
  {
    "code": 200,
    "message": "添加成功",
    "data": {
      "cartCount": 5
    }
  }
  ```

### 2. 获取购物车商品列表
- **URL:** `GET /api/cart/list`
- **请求参数:**
  - `userId` (int): 用户 ID（可以从 Token 中获取）
- **返回结果:**
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "cartItems": [
        {
          "cartId": 1,
          "productId": 1,
          "productName": "商品名称",
          "price": 99.99,
          "quantity": 2,
          "stock": 100,
          "subtotal": 199.98
        }
      ],
      "totalAmount": 199.98
    }
  }
  ```

### 3. 更新购物车商品数量
- **URL:** `PUT /api/cart/update`
- **请求参数:**
  ```json
  {
    "cartId": 1,
    "quantity": 3
  }
  ```
- **返回结果:**
  ```json
  {
    "code": 200,
    "message": "更新成功",
    "data": null
  }
  ```

### 4. 删除购物车商品
- **URL:** `DELETE /api/cart/delete/{cartId}`
- **返回结果:**
  ```json
  {
    "code": 200,
    "message": "删除成功",
    "data": null
  }
  ```

### 5. 清空购物车
- **URL:** `DELETE /api/cart/clear`
- **请求参数:**
  - `userId` (int): 用户 ID
- **返回结果:**
  ```json
  {
    "code": 200,
    "message": "清空成功",
    "data": null
  }
  ```

### 6. 获取购物车商品数量
- **URL:** `GET /api/cart/count`
- **请求参数:**
  - `userId` (int): 用户 ID
- **返回结果:**
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "count": 5
    }
  }
  ```

---

## ✅ 开发检查清单

### 前端
- [ ] 创建 Cart.vue 组件
- [ ] 创建 CartItem.vue 组件
- [ ] 创建 CartView.vue 页面
- [ ] 实现添加到购物车功能
- [ ] 实现购物车列表展示
- [ ] 实现商品数量修改功能
- [ ] 实现删除商品功能
- [ ] 实现全选/取消全选功能
- [ ] 实现总金额计算
- [ ] 实现购物车图标数量显示
- [ ] 配置路由
- [ ] 创建 cart.js API 文件
- [ ] 实现所有 Axios 请求
- [ ] 测试所有功能

### 后端
- [ ] 创建 Cart.java 实体类
- [ ] 创建 CartVO.java 视图对象
- [ ] 创建 CartRepository.java
- [ ] 创建 CartService.java 接口
- [ ] 创建 CartServiceImpl.java 实现类
- [ ] 创建 CartController.java
- [ ] 实现添加商品接口
- [ ] 实现获取购物车列表接口
- [ ] 实现更新数量接口
- [ ] 实现删除商品接口
- [ ] 实现清空购物车接口
- [ ] 实现获取商品数量接口
- [ ] 配置 MyBatis Mapper
- [ ] 添加库存检查逻辑
- [ ] 测试所有接口

---

## 📝 注意事项

1. **库存检查**：添加商品到购物车时要检查库存是否充足
2. **数量限制**：设置商品数量的最小值（1）和最大值（库存数量）
3. **重复添加**：如果购物车中已有该商品，应该累加数量而不是新增记录
4. **用户验证**：所有购物车操作都要验证用户身份
5. **实时更新**：修改数量后要实时更新小计和总计
6. **错误处理**：商品不存在或库存不足时要给出友好提示
7. **性能优化**：购物车列表要关联查询商品信息，注意 SQL 优化
8. **状态管理**：建议使用 Vuex/Pinia 管理购物车状态

---

## 🤝 协作说明

- 与商品模块开发人员协调"添加到购物车"按钮的集成
- 与订单模块开发人员协调"去结算"功能的接口
- 与用户模块开发人员协调用户身份验证
- 前后端开发人员需要提前约定好 API 接口格式
- 遇到问题及时在团队群里沟通
- 代码提交前先进行本地测试
- 使用 Git 进行版本控制，提交信息要清晰明确

---

## 💡 额外功能建议（可选）

1. **购物车持久化**：未登录用户的购物车保存在 localStorage，登录后同步到服务器
2. **失效商品提示**：商品下架或库存不足时标记为失效
3. **推荐商品**：在购物车页面展示相关推荐商品
4. **优惠券**：支持在购物车页面使用优惠券
5. **批量操作**：支持批量删除选中的商品
