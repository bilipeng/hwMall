# 订单模块开发指南

## 📋 模块概述

负责订单创建、订单列表、订单详情等功能的开发。

## 👥 负责人员

1 人负责

## 🎯 开发任务

### 任务一：订单创建功能

#### 前端开发任务

**工作目录：** `web/HwMall/src/`

1. **创建组件文件**
   - 位置：`components/Order/`
   - 需要创建的文件：
     - `OrderConfirm.vue` - 订单确认组件
     - `OrderItem.vue` - 订单商品项组件

2. **创建页面视图**
   - 位置：`views/Order/`
   - 需要创建的文件：
     - `OrderConfirmView.vue` - 订单确认页面
     - `OrderSuccessView.vue` - 订单提交成功页面

3. **创建 API 请求文件**
   - 位置：`api/`
   - 需要创建的文件：
     - `order.js` - 订单相关的 API 请求

4. **具体实现内容**
   - 开发订单确认页面布局
   - 从购物车页面接收选中的商品信息
   - 展示订单商品列表：
     - 商品名称、价格、数量
     - 小计金额
   - 提供收货地址输入框（或地址选择）
   - 显示订单总金额
   - 实现"提交订单"按钮
   - 使用 Axios 发送订单数据到后端
   - 接收后端返回的订单创建结果
   - 订单创建成功后跳转到订单详情页或成功页
   - 处理订单创建失败的情况

#### 后端开发任务

**工作目录：** `service/hwMallServicedemo/src/main/java/com/peng/hwmallservicedemo/`

1. **创建实体类（Model）**
   - 位置：`model/order/`
   - 需要创建的文件：
     - `Order.java` - 订单实体类
     - `OrderProduct.java` - 订单商品实体类
     - `OrderVO.java` - 订单视图对象
   - Order 字段：order_id, user_id, order_date, total_amount, status, address
   - OrderProduct 字段：order_product_id, order_id, product_id, quantity, price

2. **创建数据访问层（Repository）**
   - 位置：`repository/order/`
   - 需要创建的文件：
     - `OrderRepository.java` - 订单数据访问接口
     - `OrderProductRepository.java` - 订单商品数据访问接口
   - 方法：
     - `save()` - 保存订单
     - `saveOrderProducts()` - 保存订单商品
     - `findById()` - 根据 ID 查询订单
     - `findByUserId()` - 根据用户 ID 查询订单列表

3. **创建服务层（Service）**
   - 位置：`service/order/`
   - 需要创建的文件：
     - `OrderService.java` - 订单服务接口
     - `OrderServiceImpl.java` - 订单服务实现类
   - 方法：
     - `createOrder()` - 创建订单
     - `getOrderById()` - 获取订单详情
     - `getOrderList()` - 获取订单列表
     - `generateOrderNumber()` - 生成订单号

4. **创建控制器（Controller）**
   - 位置：`controller/order/`
   - 需要创建的文件：
     - `OrderController.java` - 订单控制器
   - 接口：
     - `POST /api/order/create` - 创建订单

5. **具体实现内容**
   - 接收前端发送的收货地址和商品信息
   - 验证用户身份
   - 验证商品信息和库存
   - 生成唯一订单号（建议格式：时间戳 + 随机数）
   - 计算订单总金额
   - 开启事务，保存订单和订单商品信息
   - 扣减商品库存
   - 清空购物车中已下单的商品
   - 返回订单创建结果给前端

---

### 任务二：订单列表与详情功能

#### 前端开发任务

**工作目录：** `web/HwMall/src/`

1. **创建组件文件**
   - 位置：`components/Order/`
   - 需要创建的文件：
     - `OrderList.vue` - 订单列表组件
     - `OrderDetail.vue` - 订单详情组件

2. **创建页面视图**
   - 位置：`views/Order/`
   - 需要创建的文件：
     - `OrderListView.vue` - 订单列表页面
     - `OrderDetailView.vue` - 订单详情页面

3. **更新 API 请求文件**
   - 位置：`api/order.js`
   - 添加方法：
     - `getOrderList()` - 获取订单列表
     - `getOrderDetail()` - 获取订单详情

4. **具体实现内容**
   - 开发订单列表页面布局
   - 展示订单列表信息：
     - 订单号
     - 下单时间
     - 订单状态（待付款、待发货、已发货、已完成等）
     - 订单金额
     - 商品缩略信息
   - 实现订单状态筛选（可选）
   - 点击订单进入订单详情页
   - 开发订单详情页面布局
   - 展示订单详细信息：
     - 订单号
     - 下单时间
     - 订单状态
     - 收货人信息
     - 商品清单（名称、价格、数量）
     - 订单总金额
   - 使用 Axios 请求订单数据

#### 后端开发任务

**工作目录：** `service/hwMallServicedemo/src/main/java/com/peng/hwmallservicedemo/`

1. **更新数据访问层**
   - 位置：`repository/order/OrderRepository.java`
   - 确保已有方法：
     - `findByUserId()` - 根据用户 ID 查询订单列表
     - `findById()` - 根据订单 ID 查询订单详情

2. **更新服务层**
   - 位置：`service/order/OrderService.java` 和 `OrderServiceImpl.java`
   - 确保已有方法：
     - `getOrderList()` - 获取订单列表
     - `getOrderById()` - 获取订单详情

3. **更新控制器**
   - 位置：`controller/order/OrderController.java`
   - 添加接口：
     - `GET /api/order/list` - 获取订单列表
     - `GET /api/order/{id}` - 获取订单详情

4. **具体实现内容**
   - 根据用户 ID 查询订单列表
   - 关联查询订单商品信息
   - 返回订单数据给前端
   - 支持按状态筛选订单（可选）
   - 支持分页查询（可选）

---

## 📊 数据库表结构

### 订单表（order）

| 字段名       | 数据类型      | 约束条件   | 描述                           |
| ------------ | ------------- | ---------- | ------------------------------ |
| order_id     | INT           | 主键、自增 | 订单唯一标识                   |
| user_id      | INT           | 非空、外键 | 用户ID（关联用户表）           |
| order_date   | DATETIME      | 非空       | 下单日期                       |
| total_amount | DECIMAL(10,2) | 非空       | 订单总金额                     |
| status       | VARCHAR(20)   | 非空       | 订单状态（如待付款、待发货等） |
| address      | TEXT          |            | 收货地址                       |

### 订单商品表（order_product）

| 字段名           | 数据类型      | 约束条件   | 描述                     |
| ---------------- | ------------- | ---------- | ------------------------ |
| order_product_id | INT           | 主键、自增 | 订单商品唯一标识         |
| order_id         | INT           | 非空、外键 | 订单ID（关联订单表）     |
| product_id       | INT           | 非空、外键 | 商品ID（关联商品表）     |
| quantity         | INT           | 非空       | 商品数量                 |
| price            | DECIMAL(10,2) | 非空       | 商品价格（下单时的价格） |

---

## 🔗 API 接口规范

### 1. 创建订单
- **URL:** `POST /api/order/create`
- **请求参数:**
  ```json
  {
    "userId": 1,
    "address": "收货地址",
    "products": [
      {
        "productId": 1,
        "quantity": 2,
        "price": 99.99
      }
    ],
    "totalAmount": 199.98
  }
  ```
- **返回结果:**
  ```json
  {
    "code": 200,
    "message": "订单创建成功",
    "data": {
      "orderId": 1,
      "orderNumber": "20231105123456789"
    }
  }
  ```

### 2. 获取订单列表
- **URL:** `GET /api/order/list`
- **请求参数:**
  - `userId` (int): 用户 ID
  - `status` (string, 可选): 订单状态
  - `page` (int, 可选): 页码
  - `pageSize` (int, 可选): 每页数量
- **返回结果:**
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "total": 10,
      "list": [
        {
          "orderId": 1,
          "orderNumber": "20231105123456789",
          "orderDate": "2023-11-05 12:34:56",
          "status": "待发货",
          "totalAmount": 199.98,
          "products": [
            {
              "productName": "商品名称",
              "quantity": 2
            }
          ]
        }
      ]
    }
  }
  ```

### 3. 获取订单详情
- **URL:** `GET /api/order/{id}`
- **返回结果:**
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "orderId": 1,
      "orderNumber": "20231105123456789",
      "orderDate": "2023-11-05 12:34:56",
      "status": "待发货",
      "totalAmount": 199.98,
      "address": "收货地址",
      "products": [
        {
          "productId": 1,
          "productName": "商品名称",
          "price": 99.99,
          "quantity": 2,
          "subtotal": 199.98
        }
      ]
    }
  }
  ```

---

## ✅ 开发检查清单

### 前端
- [ ] 创建 OrderConfirm.vue 组件
- [ ] 创建 OrderItem.vue 组件
- [ ] 创建 OrderList.vue 组件
- [ ] 创建 OrderDetail.vue 组件
- [ ] 创建对应的 View 页面
- [ ] 实现订单确认页面
- [ ] 实现订单列表页面
- [ ] 实现订单详情页面
- [ ] 实现订单提交功能
- [ ] 配置路由
- [ ] 创建 order.js API 文件
- [ ] 实现所有 Axios 请求
- [ ] 处理订单创建成功/失败的情况
- [ ] 测试所有功能

### 后端
- [ ] 创建 Order.java 实体类
- [ ] 创建 OrderProduct.java 实体类
- [ ] 创建 OrderVO.java 视图对象
- [ ] 创建 OrderRepository.java
- [ ] 创建 OrderProductRepository.java
- [ ] 创建 OrderService.java 接口
- [ ] 创建 OrderServiceImpl.java 实现类
- [ ] 创建 OrderController.java
- [ ] 实现创建订单接口
- [ ] 实现订单列表接口
- [ ] 实现订单详情接口
- [ ] 配置 MyBatis Mapper
- [ ] 实现订单号生成逻辑
- [ ] 实现库存扣减逻辑
- [ ] 添加事务管理
- [ ] 测试所有接口

---

## 📝 注意事项

1. **事务管理**：订单创建涉及多表操作，必须使用事务确保数据一致性
2. **订单号生成**：确保订单号唯一，建议使用时间戳 + 用户 ID + 随机数
3. **库存扣减**：创建订单时要扣减商品库存，注意并发控制
4. **数据验证**：创建订单前要验证商品信息、库存、价格等
5. **订单状态**：定义清晰的订单状态流转规则
6. **错误处理**：库存不足、商品不存在等情况要给出明确提示
7. **购物车清理**：订单创建成功后要清空购物车中已下单的商品
8. **价格快照**：订单中要保存下单时的商品价格，不受后续价格变动影响

---

## 🔄 订单状态说明

建议的订单状态流转：

1. **待付款** - 订单已创建，等待支付
2. **待发货** - 已支付，等待发货
3. **已发货** - 商品已发货
4. **已完成** - 订单完成
5. **已取消** - 订单已取消

（本项目可简化，不实现支付功能，订单创建后直接为"待发货"状态）

---

## 🤝 协作说明

- 与购物车模块开发人员协调"去结算"功能的数据传递
- 与商品模块开发人员协调库存扣减逻辑
- 与用户模块开发人员协调用户身份验证
- 前后端开发人员需要提前约定好 API 接口格式
- 遇到问题及时在团队群里沟通
- 代码提交前先进行本地测试
- 使用 Git 进行版本控制，提交信息要清晰明确

---

## 💡 额外功能建议（可选）

1. **订单状态更新**：管理员可以更新订单状态
2. **订单取消**：用户可以取消未发货的订单
3. **订单搜索**：根据订单号搜索订单
4. **订单导出**：导出订单数据为 Excel
5. **订单统计**：按时间段统计订单数量和金额
