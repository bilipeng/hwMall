# 后端启动问题修复说明

## 🔧 修复的问题

### 1. MyBatis 配置冲突
**问题**：代码中同时使用了：
- Spring Boot 的 MyBatis 自动配置（通过 `mybatis-spring-boot-starter`）
- 手动创建 `SqlSession` 的方式

这导致配置冲突，应用无法启动。

**解决方案**：
- 修改 `CartServiceImpl`，使用 Spring 的依赖注入方式
- 通过 `@Autowired` 注入 `CartRepository` 和 `ProductRepository`
- 使用 `@Transactional` 注解管理事务，而不是手动 commit/rollback

### 2. Repository 接口不完整
**问题**：`CartRepository` 缺少获取购物车列表的方法。

**解决方案**：
- 在 `CartRepository` 接口中添加 `getCartListWithProduct()` 方法
- 更新对应的 Mapper XML 文件

### 3. 商品查询方式
**问题**：直接使用 `SqlSession.selectOne()` 查询商品信息。

**解决方案**：
- 创建 `ProductRepository` 接口
- 通过 Repository 方式查询商品信息

## 📝 修改的文件

1. **CartServiceImpl.java**
   - 移除手动创建 `SqlSession` 的代码
   - 使用 `@Autowired` 注入 Repository
   - 使用 `@Transactional` 管理事务

2. **CartRepository.java**
   - 添加 `getCartListWithProduct()` 方法
   - 导入 `CartVO` 类

3. **ProductRepository.java**（新建）
   - 创建商品 Repository 接口
   - 添加 `getProductById()` 方法

4. **productmapper.xml**
   - 更新命名空间为 `com.peng.hwmallservicedemo.repository.product.ProductRepository`

5. **cartmapper.xml**
   - 更新命名空间为 `com.peng.hwmallservicedemo.repository.cart.CartRepository`

## ✅ 验证步骤

1. **检查数据库连接**
   - 确保数据库 `hwmall_db` 已创建
   - 确保 `application.yml` 中的数据库配置正确
   - 用户名：root
   - 密码：331307（根据实际情况修改）

2. **检查数据库表**
   - 确保 `cart` 表已创建
   - 确保 `product` 表已创建
   - 确保 `user` 表已创建

3. **启动应用**
   ```bash
   cd service/hwMallServicedemo
   mvn spring-boot:run
   ```

4. **检查日志**
   - 如果看到 "Started HwMallServicedemoApplication" 表示启动成功
   - 如果有错误，查看具体错误信息

## ⚠️ 注意事项

1. **数据库密码**：确保 `application.yml` 中的数据库密码与你的 MySQL 密码一致

2. **端口占用**：确保 8080 端口没有被其他程序占用

3. **MyBatis 配置**：
   - Spring Boot 会自动扫描 `@Mapper` 注解的接口
   - Mapper XML 文件需要放在 `classpath:mappers/` 目录下
   - 命名空间必须与 Repository 接口的完整类名一致

4. **事务管理**：
   - 使用 `@Transactional` 注解的方法会自动管理事务
   - 不需要手动调用 `commit()` 或 `rollback()`

## 🐛 常见错误及解决方法

### 错误1：找不到 Mapper
```
Could not find mapper for namespace: com.peng.hwmallservicedemo.repository.cart.CartRepository
```
**解决方法**：检查 `cartmapper.xml` 中的 `namespace` 属性是否与 Repository 接口的完整类名一致

### 错误2：数据库连接失败
```
Communications link failure
```
**解决方法**：
- 检查 MySQL 服务是否启动
- 检查数据库连接信息是否正确
- 检查防火墙设置

### 错误3：表不存在
```
Table 'hwmall_db.cart' doesn't exist
```
**解决方法**：执行数据库初始化脚本创建表

### 错误4：端口被占用
```
Port 8080 is already in use
```
**解决方法**：
- 修改 `application.yml` 中的 `server.port` 配置
- 或关闭占用 8080 端口的程序

## 📚 相关文档

- [Spring Boot MyBatis 官方文档](https://mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/)
- [购物车模块使用说明](./购物车模块使用说明.md)


